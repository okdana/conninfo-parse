#!/bin/bash

source "${DDT_TEST_DIR}/conninfo-parse.inc"

plan:describe 'conninfo-parse(1): shell format'

test:empty_string_is_handled_correctly() {
	conninfo-parse -s '' |
	grep -c '.' | grep -xF '0'
}

test:single_parameter_is_handled_correctly() {
	conninfo-parse -s 'dbname=foo' |
	grep -xF "dbname='foo'"

	conninfo-parse -s 'dbname=foo' |
	grep -c '.' | grep -xF '1'
}

test:multiple_parameters_are_handled_correctly() {
	conninfo-parse -s 'dbname=foo host=bar' |
	grep -xF "host='bar'"

	conninfo-parse -s 'dbname=foo host=bar' |
	grep -c '.' | grep -xF '2'
}

test:escaping_is_handled_correctly() {
	conninfo-parse -s "dbname='foo'" |
	grep -xF "dbname='foo'"

	conninfo-parse -s 'dbname="foo"' |
	grep -xF "dbname='\"foo\"'"

	conninfo-parse -s "dbname='foo\\'bar'" |
	grep -xF "dbname='foo'\\''bar'"

	conninfo-parse -s "dbname='foo\\\\\\'bar'" |
	grep -xF "dbname='foo\\'\\''bar'"
}

