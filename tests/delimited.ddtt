#!/bin/bash

source "${DDT_TEST_DIR}/conninfo-parse.inc"

plan:describe 'conninfo-parse(1): delimited format'

test:default_output_is_tab-delimited() {
	conninfo-parse 'dbname=foo' |
	grep -xF $'dbname\tfoo'
}

test:explicit_delimiters_are_handled_correctly() {
	conninfo-parse -d $'\t' 'dbname=foo' |
	grep -xF $'dbname\tfoo'

	conninfo-parse -d $':' 'dbname=foo' |
	grep -xF 'dbname:foo'

	conninfo-parse -d '=>' 'dbname=foo' |
	grep -xF 'dbname=>foo'
}

test:empty_string_is_handled_correctly() {
	conninfo-parse -d $'\t' '' |
	grep -c '.' | grep -xF '0'
}

test:single_parameter_is_handled_correctly() {
	conninfo-parse -d ':' 'dbname=foo' |
	grep -c '.' | grep -xF '1'
}

test:multiple_parameters_are_handled_correctly() {
	conninfo-parse -d ':' 'dbname=foo host=bar' |
	grep -c '.' | grep -xF '2'
}

